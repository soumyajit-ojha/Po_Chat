{% extends '../base.html' %}
{% load static %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/personal/home.css' %}">
{% endblock %}

{% block content %}
<div class="home-container">
    <div class="recent-chats-header">
        <h2 class="recent-chats-title">Recent Chats</h2>
        <a href="#" class="new-chat-btn">
            <i class="material-icons">add</i>
            <span class="btn-text">New Chat</span>
        </a>
    </div>

    {% if recent_chats %}
    <div class="recent-chats-container">
        {% for chat in recent_chats %}
        <a href="#" class="friend-card">
            <div class="avatar-container">
                <img src="{{ chat.friend.profile_image.url }}" alt="{{ chat.friend.username }}" class="friend-avatar">
                {% if chat.friend.is_online %}
                <div class="online-status" title="Online"></div>
                {% else %}
                <div class="offline-status" title="Offline"></div>
                {% endif %}
            </div>
            <div class="friend-info">
                <div class="friend-name">{{ chat.friend.username }}</div>
                <div class="last-message">
                    {% if chat.last_message %}
                        {% if chat.last_message.sender == request.user %}
                            You: {{ chat.last_message.content|truncatechars:30 }}
                        {% else %}
                            {{ chat.last_message.content|truncatechars:30 }}
                        {% endif %}
                    {% else %}
                        Start a new conversation
                    {% endif %}
                </div>
            </div>
            <div class="chat-time">
                {% if chat.last_message %}
                    {{ chat.last_message.timestamp|timesince }} ago
                {% endif %}
            </div>
        </a>
        {% endfor %}
    </div>
    {% else %}
    <div class="no-friends-container">
        <div class="no-friends-icon">
            <i class="material-icons">people_outline</i>
        </div>
        <h3 class="no-friends-title">No friends to chat with yet</h3>
        <p class="no-friends-text">Start by adding friends to your network. You can search for people you know or discover new friends.</p>
        <a href="#" class="add-friends-btn">
            <i class="material-icons">person_add</i>
            <span class="btn-text">Add Friends</span>
        </a>
    </div> 
    {% endif %}
</div>
{% endblock %}